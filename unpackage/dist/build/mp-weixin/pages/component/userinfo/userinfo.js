"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/api.js"),l=require("../../../common/assets.js");if(!Array){e.resolveComponent("uni-card")()}Math;const t={__name:"userinfo",setup(t){const r=e.ref(l.avatar);e.ref(null);const n=e.ref("");let u=e.ref(),o=e.ref(),i=e.ref(!1);u.value=e.index.getStorageSync("token"),o.value=e.index.getStorageSync("userinfo"),e.onLoad((()=>{i.value=!1,r.value=o.value.avatar_url,v.value.avatar_url=o.value.avatar_url,v.value.nickname=o.value.nickname,n.value=o.value.username})),e.ref([{text:"男",value:0},{text:"女",value:1},{text:"保密",value:2}]);let v=e.ref({nickname:"",avatar_url:l.avatar});const s=e=>{console.log(e.detail.value),v.value.nickname=e.detail.value},c=e=>{console.log(e.detail),r.value=e.detail.avatarUrl,v.value.avatar_url=e.detail.avatarUrl,i.value=!0};return(l,t)=>({a:r.value,b:e.o(c),c:e.t(n.value),d:e.o([a=>e.unref(v).nickname=a.detail.value,s]),e:e.unref(v).nickname,f:e.o((l=>(async()=>{e.index.showLoading({title:"保存中..."}),console.log(i.value);try{if(i.value){const a=r.value;let l=await e.index.uploadFile({url:"https://api.suxin23.cn/upload/token/rich_editor_upload",filePath:a,name:"file",header:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${u.value}`}});console.log("response:",l),l=JSON.parse(l.data),console.log("response:",l),r.value=l.data.href,v.value.avatar_url=l.data.href}const l=await a.put(`/users/token/${o.value.id}`,v.value);console.log(l.data),200===l.data.code&&(o.value.nickname=v.value.nickname,o.value.avatar_url=v.value.avatar_url,console.log(o.value),e.index.setStorageSync("userinfo",o.value),e.index.$emit("userinfoSuccess",o.value),e.index.navigateBack({delta:1}))}catch(l){console.error("error",l)}e.index.hideLoading()})())),g:e.t(e.unref(v))})}};wx.createPage(t);
