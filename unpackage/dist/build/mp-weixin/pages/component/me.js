"use strict";const e=require("../../common/vendor.js"),n=require("../../common/assets.js");if(!Array){(e.resolveComponent("uni-popup-message")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-section")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-card"))()}Math||((()=>"../../uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js"))();const o={__name:"me",setup(o){let u=e.ref(""),i=e.ref("");const s=e.ref(null),a=e.ref(null);let r=e.ref({}),p=e.ref(n.avatar),t=e.ref(10),l=e.ref("点击登录");e.onLoad((()=>{console.log("个人中心"),f()})),e.onMounted((()=>{console.log("挂载监听"),e.index.$on("loginSuccess",f),e.index.$on("userinfoSuccess",d)})),e.onUnmounted((()=>{e.index.$off("loginSuccess",f),e.index.$off("userinfoSuccess",d)}));const c=()=>{a.value.open()},d=e=>{console.log("头像更新成功"),p.value=e.avatar_url,l.value=e.nickname},m=()=>{e.index.getStorageSync("userinfo").is_root?e.index.navigateTo({url:"/pages/component/add"}):(u.value="error",i.value="网络繁忙",s.value.open())},g=()=>new Promise(((n,o)=>{e.index.getStorageSync("token")?n():o()})),f=()=>{g().then((()=>{const n=e.index.getStorageSync("userinfo");p.value=n.avatar_url,l.value=n.nickname?n.nickname:n.username,r.value=n})).catch((()=>{e.index.navigateTo({url:"/pages/component/login/login"})}))},v=()=>{e.index.removeStorageSync("token"),e.index.removeStorageSync("userinfo"),p.value=n.avatar,l.value="点击登录",r.value="",e.index.reLaunch({url:"/pages/index/index",success:()=>{console.log("uni-app刷新成功")},fail:e=>{console.error("uni-app刷新失败",e)}})},x=()=>{g().then((()=>{e.index.navigateTo({url:"/pages/component/userinfo/userinfo"})})).catch((()=>{e.index.navigateTo({url:"/pages/component/login/login"})}))};return(n,o)=>e.e({a:e.p({type:e.unref(u),message:e.unref(i),duration:2e3}),b:e.sr(s,"8d85b864-0",{k:"message"}),c:e.p({type:"message"}),d:e.o(n.input),e:e.o((e=>n.value=e)),f:e.p({errorMessage:!0,focus:!0,placeholder:"请输入原密码",modelValue:n.value}),g:e.p({title:"原密码",type:"line",padding:!0}),h:e.o(n.input),i:e.o((e=>n.value=e)),j:e.p({errorMessage:!0,focus:!0,placeholder:"请输入新密码",modelValue:n.value}),k:e.o(n.input),l:e.o((e=>n.value=e)),m:e.p({errorMessage:!0,focus:!0,placeholder:"请重新输入新密码",modelValue:n.value}),n:e.p({title:"新密码",type:"line",padding:!0}),o:e.p({title:"密码修改"}),p:e.sr(a,"8d85b864-2",{k:"inputDialog"}),q:e.p({type:"dialog"}),r:e.unref(p),s:e.t(e.unref(l)),t:e.o(x),v:"点击登录"!==e.unref(l)},"点击登录"!==e.unref(l)?{w:e.t(e.unref(t)),x:e.t(e.unref(t))}:{},{y:"点击登录"!==e.unref(l)},"点击登录"!==e.unref(l)?{z:e.o(m),A:e.o(c),B:e.o(v)}:{},{C:"点击登录"!==e.unref(l)},"点击登录"!==e.unref(l)?{D:e.o(v)}:{},{E:"点击登录"!==e.unref(l)},"点击登录"!==e.unref(l)?{F:e.t(e.unref(r))}:{})}};wx.createPage(o);
