"use strict";const e=require("../../common/vendor.js"),n=require("../../common/assets.js");if(!Array){(e.resolveComponent("uni-popup-message")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-card"))()}Math||((()=>"../../uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js"))();const o={__name:"me",setup(o){let u=e.ref(""),r=e.ref("");const a=e.ref(null);let s=e.ref({}),i=e.ref(n.avatar),t=e.ref(10),p=e.ref("点击登录");e.onLoad((()=>{m()})),e.onMounted((()=>{e.index.$on("loginSuccess",m)})),e.onUnmounted((()=>{e.index.$off("loginSuccess",m)}));const c=()=>{},l=()=>new Promise(((n,o)=>{e.index.getStorageSync("token")?n():o()})),m=()=>{l().then((()=>{const n=e.index.getStorageSync("userinfo");i.value=n.avatar_url,p.value=n.nickname?n.nickname:n.username,s.value=n})).catch((()=>{e.index.navigateTo({url:"/pages/component/login/login"})}))},f=()=>{e.index.removeStorageSync("token"),e.index.removeStorageSync("userinfo"),i.value=n.avatar,p.value="点击登录",s.value="",e.index.reLaunch({url:"/pages/index/index",success:()=>{console.log("uni-app刷新成功")},fail:e=>{console.error("uni-app刷新失败",e)}})},g=()=>{l().then((()=>{e.index.navigateTo({url:"/pages/component/userinfo/userinfo"})})).catch((()=>{e.index.navigateTo({url:"/pages/component/login/login"})}))};return(n,o)=>e.e({a:e.p({type:e.unref(u),message:e.unref(r),duration:2e3}),b:e.sr(a,"8d85b864-0",{k:"message"}),c:e.p({type:"message"}),d:e.unref(i),e:e.t(e.unref(p)),f:e.o(g),g:"点击登录"!==e.unref(p)},"点击登录"!==e.unref(p)?{h:e.t(e.unref(t)),i:e.t(e.unref(t))}:{},{j:"点击登录"!==e.unref(p)},"点击登录"!==e.unref(p)?{k:e.o(c),l:e.o(f)}:{},{m:"点击登录"!==e.unref(p)},"点击登录"!==e.unref(p)?{n:e.o(f)}:{},{o:"点击登录"!==e.unref(p)},"点击登录"!==e.unref(p)?{p:e.t(e.unref(s))}:{})}};wx.createPage(o);
